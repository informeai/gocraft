package internal

import "log"

var (
	Tex = NewItemHub()
)

type FaceTexture [6][2]float32

func MakeFaceTexture(idx int) FaceTexture {
	const textureColums = 16
	var m = 1 / float32(textureColums)
	dx, dy := float32(idx%textureColums)*m, float32(idx/textureColums)*m
	n := float32(1 / 2048.0)
	m -= n
	return [6][2]float32{
		{dx + n, dy + n},
		{dx + m, dy + n},
		{dx + m, dy + m},
		{dx + m, dy + m},
		{dx + n, dy + m},
		{dx + n, dy + n},
	}
}

type BlockTexture struct {
	Left, Right FaceTexture
	Up, Down    FaceTexture
	Front, Back FaceTexture
}

type ItemHub struct {
	tex map[int]*BlockTexture
}

func NewItemHub() *ItemHub {
	return &ItemHub{
		tex: make(map[int]*BlockTexture),
	}
}

func (h *ItemHub) AddTexture(w, l, r, u, d, f, b int) {
	h.tex[w] = &BlockTexture{
		Left:  MakeFaceTexture(l),
		Right: MakeFaceTexture(r),
		Up:    MakeFaceTexture(u),
		Down:  MakeFaceTexture(d),
		Front: MakeFaceTexture(f),
		Back:  MakeFaceTexture(b),
	}
}

func (h *ItemHub) Texture(w int) *BlockTexture {
	t, ok := h.tex[w]
	if !ok {
		log.Printf("%d not found", w)
		return h.tex[0]
	}
	return t
}

func LoadTextureDesc() error {
	for w, f := range ItemDesc {
		Tex.AddTexture(w, f[0], f[1], f[2], f[3], f[4], f[5])
	}
	return nil
}

// w => left, right, top, bottom, front, back
var ItemDesc = map[int][6]int{
	0:  {0, 0, 0, 0, 0, 0},             // 0 - empty
	1:  {16, 16, 32, 0, 16, 16},        // 1 - grass
	2:  {1, 1, 1, 1, 1, 1},             // 2 - sand
	3:  {2, 2, 2, 2, 2, 2},             // 3 - stone
	4:  {3, 3, 3, 3, 3, 3},             // 4 - brick
	5:  {20, 20, 36, 4, 20, 20},        // 5 - wood
	6:  {5, 5, 5, 5, 5, 5},             // 6 - cement
	7:  {6, 6, 6, 6, 6, 6},             // 7 - dirt
	8:  {7, 7, 7, 7, 7, 7},             // 8 - plank
	9:  {24, 24, 40, 8, 24, 24},        // 9 - snow
	10: {9, 9, 9, 9, 9, 9},             // 10 - glass
	11: {10, 10, 10, 10, 10, 10},       // 11 - cobble
	12: {11, 11, 11, 11, 11, 11},       // 12 - light stone
	13: {12, 12, 12, 12, 12, 12},       // 13 - dark stone
	14: {13, 13, 13, 13, 13, 13},       // 14 - chest
	15: {14, 14, 14, 14, 14, 14},       // 15 - leaves
	16: {15, 15, 15, 15, 15, 15},       // 16 - cloud
	17: {48, 48, 0, 0, 48, 48},         // 17 - tall grass
	18: {49, 49, 0, 0, 49, 49},         // 18 - yellow flower
	19: {50, 50, 0, 0, 50, 50},         // 19 - red flower
	20: {51, 51, 0, 0, 51, 51},         // 20 - purple flower
	21: {52, 52, 0, 0, 52, 52},         // 21 - sun flower
	22: {53, 53, 0, 0, 53, 53},         // 22 - white flower
	23: {54, 54, 0, 0, 54, 54},         // 23 - blue flower
	24: {0, 0, 0, 0, 0, 0},             // 24
	25: {0, 0, 0, 0, 0, 0},             // 25
	26: {0, 0, 0, 0, 0, 0},             // 26
	27: {0, 0, 0, 0, 0, 0},             // 27
	28: {0, 0, 0, 0, 0, 0},             // 28
	29: {0, 0, 0, 0, 0, 0},             // 29
	30: {0, 0, 0, 0, 0, 0},             // 30
	31: {0, 0, 0, 0, 0, 0},             // 31
	32: {176, 176, 176, 176, 176, 176}, // 32
	33: {177, 177, 177, 177, 177, 177}, // 33
	34: {178, 178, 178, 178, 178, 178}, // 34
	35: {179, 179, 179, 179, 179, 179}, // 35
	36: {180, 180, 180, 180, 180, 180}, // 36
	37: {181, 181, 181, 181, 181, 181}, // 37
	38: {182, 182, 182, 182, 182, 182}, // 38
	39: {183, 183, 183, 183, 183, 183}, // 39
	40: {184, 184, 184, 184, 184, 184}, // 40
	41: {185, 185, 185, 185, 185, 185}, // 41
	42: {186, 186, 186, 186, 186, 186}, // 42
	43: {187, 187, 187, 187, 187, 187}, // 43
	44: {188, 188, 188, 188, 188, 188}, // 44
	45: {189, 189, 189, 189, 189, 189}, // 45
	46: {190, 190, 190, 190, 190, 190}, // 46
	47: {191, 191, 191, 191, 191, 191}, // 47
	48: {192, 192, 192, 192, 192, 192}, // 48
	49: {193, 193, 193, 193, 193, 193}, // 49
	50: {194, 194, 194, 194, 194, 194}, // 50
	51: {195, 195, 195, 195, 195, 195}, // 51
	52: {196, 196, 196, 196, 196, 196}, // 52
	53: {197, 197, 197, 197, 197, 197}, // 53
	54: {198, 198, 198, 198, 198, 198}, // 54
	55: {199, 199, 199, 199, 199, 199}, // 55
	56: {200, 200, 200, 200, 200, 200}, // 56
	57: {201, 201, 201, 201, 201, 201}, // 57
	58: {202, 202, 202, 202, 202, 202}, // 58
	59: {203, 203, 203, 203, 203, 203}, // 59
	60: {204, 204, 204, 204, 204, 204}, // 60
	61: {205, 205, 205, 205, 205, 205}, // 61
	62: {206, 206, 206, 206, 206, 206}, // 62
	63: {207, 207, 207, 207, 207, 207}, // 63
	64: {226, 224, 241, 209, 227, 225}, // 64
}

var AvailableItems = []int{
	1,
	2,
	3,
	4,
	5,
	6,
	7,
	8,
	9,
	10,
	11,
	12,
	13,
	14,
	15,
	16,
	17,
	18,
	19,
	20,
	21,
	22,
	23,
	32,
	33,
	34,
	35,
	36,
	37,
	38,
	39,
	40,
	41,
	42,
	43,
	44,
	45,
	46,
	47,
	48,
	49,
	50,
	51,
	52,
	53,
	54,
	55,
	56,
	57,
	58,
	59,
	60,
	61,
	62,
	63,
	64,
}
